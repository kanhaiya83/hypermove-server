<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
</head>
<style>
    body{
        text-align: center;
    }
    .show{
        display: block!important;
    }
    .main-content{
        display: none;
    }
    .login-container{
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 700px;
        margin: 0 auto;
        display: none;
    }
    .heading{
        margin-bottom: 2rem;
    }
    .table-container{
        display: none;
    }
    .loader{
        width: 100%;
        text-align: center;
        display: none;
    }
    table{

        width: 100%;
        text-align: center;
    }
    .delete-btn{
        background-color: #F34440;
        color: white;
        padding: 0.2rem 1rem;
        border-radius: 100rem;
        border: none;
        font-size: 1.1rem;
    }
    .delete-btn:hover{
        cursor: pointer;
    }
    .table-container tr{
        padding:0.5rem 0;
    }
</style>
<body>
    <h1 className="heading">Admin Panel</h1>
    <div class="login-container show">
        <h5>Please enter the password:</h5>
        <form class="login-form">
            
        <input type="text" id="password" >
        <button>Login</button>
        </form>
    </div>
   <div class="main-content">
    <div class="loader show"> <h4>Loading...</h4></div>
<div class="table-container">
    <table>
        <tbody>
           <tr> <th>Number</th>
            <th>Name</th>
            <th>Score</th>
            <th>Wallet Address</th></tr>
            
        </tbody>
    </table>
</div>
   </div>
    <script>
const deleteItem=(id,btn)=>{
    const row=btn.parentElement.parentElement
    fetch("/score/"+id,{method:"DELETE",headers:{"auth-password":"admin"}}).then(d=>d.json()).then(res=>{
        if(res.success){
            row.remove()
        }
    })
}
        const addListeners=()=>{
            document.querySelectorAll(".delete-btn").forEach(btn=>{
                btn.addEventListener("click",()=>{
                    btn.innerHTML="Deleting..."
                    const id=btn.dataset.id
                    console.log(id)
                    deleteItem(id,btn)

                })
            })
        }
        (async ()=>{
            const res=await fetch("/score")
            const data= await res.json();
            if(data.success){
                data.scores.forEach((sc,i)=>{
                    const row=document.createElement("tr")
                    row.innerHTML=`
                    <td>${i+1}</td>
            <td>${sc.name}</td>
            <td>${sc.score}</td>
            <td>${sc.walletAddress}</td>
            <td><button data-id=${sc._id} class="delete-btn">Remove</button></td>`

            document.querySelector("tbody").appendChild(row)
                })
                addListeners()
                document.querySelector(".table-container").classList.add("show")
                document.querySelector(".loader").classList.remove("show")
            }


        })()
    </script>
    <script>
        document.querySelector(".login-form").addEventListener("submit",(e)=>{
            e.preventDefault()
            if(e.target["password"].value === "admin"){
                document.querySelector(".login-container").classList.remove("show")
                document.querySelector(".main-content").classList.add("show")
            }
        })
    </script>
</body>
</html>